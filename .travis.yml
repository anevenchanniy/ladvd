language: c
compiler:
  - clang
  - gcc
matrix:
  include:
    - compiler: gcc
      env: GCOV=1

before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -qq libevent-dev libpcap-dev libcap-ng-dev libmnl-dev 
  - sudo apt-get install -qq libpci-dev autotools-dev check pkg-config
  - sudo pip install cpp-coveralls
  - sudo ip tuntap add dev eth0 mode tap
  - sudo ip link set eth0 up
before_script:
  - git log --no-merges > doc/ChangeLog
  - autoreconf -i
script:
  - 'if [ "$GCOV" = 1 ]; then FLAGS="$FLAGS --enable-gcov"; fi'
  - './configure $FLAGS && make && make check'
after_success:
  - 'if [ "$GCOV" = 1 ]; then coveralls -b src -r src -e compat -E ".*\.h" --gcov-options "\-lp"; fi'
